!function(){"use strict";function a(){EventEmitter2.apply(this),this.ros=new ROSLIB.Ros,this.ros.on("connection",this.onConnection.bind(this)),this.ros.on("close",this.onClose.bind(this)),this.ros.on("error",this.onError.bind(this)),this.on("status",function(a){switch(a){case"closed":setTimeout(this.connect.bind(this),c)}}),this.connect(),this.ed=new Ed(this),this.hardware=new Hardware(this)}var b="ws://"+window.location.hostname+":9090",c=5e3;a.prototype=Object.create(EventEmitter2.prototype),Object.defineProperty(a.prototype,"status",{get:function(){return this._status},set:function(a){this._status=a,this.emit("status",a)}}),a.prototype.connect=function(){console.log("connecting to "+b),this.ros.connect(b),this.status="connecting"},a.prototype.onConnection=function(){console.log("connection"),this.status="connected"},a.prototype.onClose=function(){console.log("connection closed"),this.status="closed"},a.prototype.onError=function(){this.status="error"},window.Robot=a}(),function(){"use strict";function a(a){EventEmitter2.apply(this);var b=a.ros;this.status=[],this.status_topic=b.Topic({name:"hardware_status",messageType:"diagnostic_msgs/DiagnosticArray",throttle_rate:500}),this.status_topic.subscribe(this.onStatus.bind(this)),this.models=[]}function b(a){var b=a.status.map(function(a){return{name:a.name,level:a.level,homed:"homed"===a.message}}),d=_.indexBy(b,"name");return _.defaults(d,g),_.mapValues(d,function(a){return a.actions=c(a),a}),d}function c(a){var b=e[a.name];if(b){var c=a?a.level:-1,f=a?a.homed:!1,g={};return b.homeable&&(g.home={enabled:c===d.IDLE,warning:f?"This part was already homed, Are you sure you want to redo homing?":!1}),g.start={enabled:c===d.IDLE&&(f||!b.homeable_mandatory),warning:b.homeable&&!f?"This part is not yet homed, Are you sure you want to proceed?":!1},g.stop={enabled:c===d.HOMING||c===d.OPERATIONAL},b.resetable&&(g.reset={enabled:c===d.ERROR}),g}}var d={STALE:0,IDLE:1,OPERATIONAL:2,HOMING:3,ERROR:4},e={all:[!0,!1,!0],base:[!1,!1,!0],spindle:[!0,!0,!0],left_arm:[!0,!1,!0],right_arm:[!0,!1,!0],head:[!1,!1,!1]};e=_.mapValues(e,function(a){return{homeable:a[0],homeable_mandatory:a[1],resetable:a[2]}});var f={all:0,base:1,spindle:2,left_arm:3,right_arm:4,head:5},g=_.mapValues(f,function(a,b){return{name:b,level:d.STALE,homed:!1}});a.prototype=Object.create(EventEmitter2.prototype),Object.defineProperty(a.prototype,"status",{get:function(){return this._status},set:function(a){this._status=a,this.emit("status",a)}}),a.prototype.onStatus=function(a){this.status=b(a)},window.Hardware=a}(),function(){"use strict";function a(a){EventEmitter2.apply(this);var g=a.ros;this.entities=[],this.meshes={},this.entities_topic=g.Topic({name:b,messageType:"ed_gui_server/EntityInfos",throttle_rate:5e3}),this.query_meshes_service=g.Service({name:c,serviceType:"ed_gui_server/QueryMeshes"}),this.snapshots={},this.snapshot_reision=0,this.snapshot_service=g.Service({name:d,serviceType:"ed_sensor_integration/GetSnapshots"}),this.update_snapshots(function h(){_.delay(this.update_snapshots.bind(this),1e3,h.bind(this))}.bind(this)),this.models={},this.models_service=g.Service({name:e,serviceType:"ed_sensor_integration/GetModels"}),this.update_models(),this.fit_model_service=g.Service({name:f,serviceType:"ed_sensor_integration/FitModel"})}var b="ed/gui/entities",c="ed/gui/query_meshes",d="ed/gui/get_snapshots",e="ed/gui/get_models",f="ed/gui/fit_model";a.prototype=Object.create(EventEmitter2.prototype),Object.defineProperty(a.prototype,"entities",{get:function(){return this._entities},set:function(a){this._entities=a,this.emit("entities",a)}}),a.prototype.onEntities=function(a){console.log(a),this.entities=a.entities;var b=[];this.entities.forEach(function(a){this.meshes[a.id]&&this.meshes[a.id].revision===a.mesh_revision?console.log("correct revision"):b.push(a.id)}.bind(this)),console.log(b);var c={entity_ids:b};this.query_meshes_service.callService(c,function(a){var b=a.error_msg;b&&console.warn("query_meshes_service:",b),a.entity_ids.forEach(function(b,c){this.meshes[b]=a.meshes[c]}.bind(this))}.bind(this))},a.prototype.update_snapshots=function(a){a=a||_.noop;var b={revision:this.snapshot_revision};this.snapshot_service.callService(b,function(b){this.snapshot_revision=b.new_revision,b.image_ids.forEach(function(a,c){var d=b.images[c],e=d.encoding;d.src="data:image/"+e+";base64,"+d.data,d.short_id=_.trunc(a,{length:8,omission:""}),this.snapshots[a]=d}.bind(this)),this.emit("snapshots",this.snapshots),a(this.snapshots)}.bind(this))},a.prototype.update_models=function(){var a={};this.models_service.callService(a,function(a){a.model_names.forEach(function(b,c){var d=a.model_images[c],e=d.encoding;d.src="data:image/"+e+";base64,"+d.data,this.models[b]=d}.bind(this)),this.emit("models",this.models)}.bind(this))},a.prototype.fit_model=function(a,b,c,d){var e={model_name:a,image_id:b,click_x:c,click_y:d};this.fit_model_service.callService(e,function(a){var b=a.error_msg;b&&console.warn("fit model error:",b)})},window.Ed=a}(),angular.module("challengeOpenApp",["ngDraggable"]),angular.module("challengeOpenApp").controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("challengeOpenApp").provider("robot",function(){this.setUrl=function(a){this.url=a},this.$get=function(){var a=window.r=new Robot;return a}}),angular.module("challengeOpenApp").controller("ConnectionCtrl",["$scope","robot",function(a,b){a.connection=b.status,b.on("status",function(b){console.log("new status",b),a.$apply(function(){a.connection=b})})}]),angular.module("challengeOpenApp").controller("ModellistCtrl",["$scope","robot",function(a,b){a.models=b.ed.models,b.ed.on("models",function(b){a.$apply(function(){a.models=b})})}]),angular.module("challengeOpenApp").controller("SnapshotlistCtrl",["robot","$scope",function(a,b){b.snapshots=a.ed.snapshots,b.select=function(a){b.selected=a},a.ed.on("snapshots",function(a){b.$apply(function(){b.snapshots=a})}),b.onDragComplete=function(a,b){console.log("drag success, data:",a,b)},b.onDropComplete=function(c,d){a.ed.fit_model(c,b.selected,d.x,d.y)}}]),angular.module("challengeOpenApp").controller("SnapshotlabelerCtrl",["$scope",function(a){}]),angular.module("challengeOpenApp").controller("TriggerCtrl",["$scope","robot",function(a,b){var c=b.ros.Topic({name:"trigger",messageType:"std_msgs/String"});a.trigger=function(a){c.publish({data:a})}}]),angular.module("challengeOpenApp").directive("ngTap",function(){return function(a,b,c){var d;return d=!1,b.bind("click",function(){return d?void 0:a.$apply(c.ngTap)}),b.bind("touchstart",function(a){return d=!0}),b.bind("touchmove",function(a){return d=!1,a.stopImmediatePropagation()}),b.bind("touchend",function(){return d?a.$apply(c.ngTap):void 0})}}),angular.module("challengeOpenApp").run(["$templateCache",function(a){"use strict";a.put("views/main.html",'<div class="container-fluid snapshot-model-editor" ng-controller="SnapshotlistCtrl"> <div class="row top-row"> <div ng-controller="ModellistCtrl" class="col-xs-12 models" ng-style="{ \'background-image\': \'url(\'+snapshots[selected].src+\')\' }" ng-drop="true" ng-drop-success="onDropComplete($data,$event)"> <button ng-repeat="(id, model) in models" type="button" class="btn btn-lg" ng-class="{ \'btn-primary\': selected == id, \'btn-default\': selected != id }" ng-drag="true" ng-center-anchor="true" ng-drag-data="id" ng-drag-success="onDragComplete($data,$event)"> {{snapshot.short_id}} <img class="img-responsive" src="{{model.src}}"> </button> </div> </div> <div class="row bottom-row"> <div class="col-xs-10 snapshots"> <button ng-repeat="(id, snapshot) in snapshots" type="button" class="btn btn-lg" ng-class="{ \'btn-primary\': selected == id, \'btn-default\': selected != id }" ng-click="select(id)" ng-tap="select(id)"> <img class="img-responsive" src="{{snapshot.src}}"> </button> </div> <div class="col-xs-2 logo"></div> </div> </div>')}]);